{"ast":null,"code":"import _toConsumableArray from\"C:\\\\Users\\\\VASILISVITTIS\\\\Documents\\\\main\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"C:\\\\Users\\\\VASILISVITTIS\\\\Documents\\\\main\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\VASILISVITTIS\\\\Documents\\\\main\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"C:\\\\Users\\\\VASILISVITTIS\\\\Documents\\\\main\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\VASILISVITTIS\\\\Documents\\\\main\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _assertThisInitialized from\"C:\\\\Users\\\\VASILISVITTIS\\\\Documents\\\\main\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";import _inherits from\"C:\\\\Users\\\\VASILISVITTIS\\\\Documents\\\\main\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\VASILISVITTIS\\\\Documents\\\\main\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import classes from'./Layout.module.css';import React,{Component}from'react';import{Container,Row,Col}from'react-bootstrap';import NavigationBar from\"./Navbar\";import Banner from\"./Banner\";import PostSection from\"../posts/PostSection\";import Web3 from\"web3\";import Blog from\"../../abis/Blog.json\";var Layout=/*#__PURE__*/function(_Component){_inherits(Layout,_Component);var _super=_createSuper(Layout);function Layout(props){var _this;_classCallCheck(this,Layout);_this=_super.call(this,props);_this.state={accountAddress:'',userConnected:false,blogPost:null,postCount:0,posts:[],loading:true,commentLoading:false,postLoading:true};_this.createPost=_this.createPost.bind(_assertThisInitialized(_this));_this.commentPost=_this.commentPost.bind(_assertThisInitialized(_this));_this.setUserAddress=_this.setUserAddress.bind(_assertThisInitialized(_this));return _this;}_createClass(Layout,[{key:\"componentWillMount\",value:function(){var _componentWillMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return this.fetchData();case 2:case\"end\":return _context.stop();}}},_callee,this);}));function componentWillMount(){return _componentWillMount.apply(this,arguments);}return componentWillMount;}()},{key:\"fetchData\",value:function(){var _fetchData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var web3,networkId,networkData,blogPost,postCount,i,post;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!window.ethereum){_context2.next=28;break;}window.web3=new Web3(window.ethereum);// } else\n// if (window.web3) {\n// window.web3 = new Web3(window.web3.currentProvider)\n// window.web3 = new Web3(window.ethereum)\nweb3=window.web3;_context2.next=5;return web3.eth.net.getId();case 5:networkId=_context2.sent;networkData=Blog.networks[networkId];if(!networkData){_context2.next=28;break;}this.setState({loading:false});this.setState({postLoading:false});blogPost=new web3.eth.Contract(Blog.abi,networkData.address);this.setState({blogPost:blogPost});_context2.next=14;return blogPost.methods.postCount().call();case 14:postCount=_context2.sent;this.setState({postCount:postCount});// Load Posts\nthis.setState({posts:[]});i=1;case 18:if(!(i<=postCount)){_context2.next=26;break;}_context2.next=21;return blogPost.methods.posts(i).call();case 21:post=_context2.sent;this.setState({posts:[].concat(_toConsumableArray(this.state.posts),[post])});case 23:i++;_context2.next=18;break;case 26:// Sort posts. Show highest tipped posts first\nthis.setState({posts:this.state.posts.sort(function(a,b){return b.id-a.id;})});this.setState({loading:false});case 28:case\"end\":return _context2.stop();}}},_callee2,this);}));function fetchData(){return _fetchData.apply(this,arguments);}return fetchData;}()},{key:\"createPost\",value:function(){var _createPost=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(title,content){var _this2=this;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:this.setState({postLoading:true});this.state.blogPost.methods.createPost(title,content).send({from:this.props.account.toString()}).once('receipt',function(receipt){_this2.fetchData();_this2.setState({postLoading:false});console.log(_this2.state.accountAddress);});case 2:case\"end\":return _context3.stop();}}},_callee3,this);}));function createPost(_x,_x2){return _createPost.apply(this,arguments);}return createPost;}()},{key:\"commentPost\",value:function(){var _commentPost=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(id,content){var _this3=this;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:this.setState({postLoading:true});this.setState({commentLoading:true});this.state.blogPost.methods.commentPost(id,content).send({from:this.state.accountAddress}).once('receipt',function(receipt){_this3.fetchData();_this3.setState({commentLoading:false});_this3.setState({postLoading:false});});case 3:case\"end\":return _context4.stop();}}},_callee4,this);}));function commentPost(_x3,_x4){return _commentPost.apply(this,arguments);}return commentPost;}()},{key:\"setUserAddress\",value:function(){var _setUserAddress=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(input){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:this.setState({accountAddress:input});case 1:case\"end\":return _context5.stop();}}},_callee5,this);}));function setUserAddress(_x5){return _setUserAddress.apply(this,arguments);}return setUserAddress;}()},{key:\"render\",value:function render(){return/*#__PURE__*/React.createElement(Container,{fluid:true,className:classes.container},/*#__PURE__*/React.createElement(NavigationBar,{userAccount:this.setUserAddress,account:this.props.account,setAccount:this.props.setAccount}),/*#__PURE__*/React.createElement(Row,{className:classes.main},/*#__PURE__*/React.createElement(Col,{lg:4,className:classes.col4},\" \",/*#__PURE__*/React.createElement(Banner,{createpost:this.createPost,input:this.props.account}),\" \"),/*#__PURE__*/React.createElement(Col,{lg:8,className:classes.col8},\" \",/*#__PURE__*/React.createElement(PostSection,{commentLoading:this.state.commentLoading,blogPost:this.state.blogPost,account:this.props.account,loading:this.state.loading,postLoading:this.state.postLoading,postSectionPosts:this.state.posts,commentPost:this.commentPost,input:this.props.account}),\" \")),/*#__PURE__*/React.createElement(\"footer\",{id:\"sticky-footer\",className:\"flex-shrink-0 py-4 bg-dark text-white-50\"},/*#__PURE__*/React.createElement(\"div\",{className:\"container text-center\"},/*#__PURE__*/React.createElement(\"small\",null,\"Copyright \\xA9 billvittis.eth\"))));}}]);return Layout;}(Component);export default Layout;","map":{"version":3,"sources":["C:/Users/VASILISVITTIS/Documents/main/src/components/layout/Layout.js"],"names":["classes","React","Component","Container","Row","Col","NavigationBar","Banner","PostSection","Web3","Blog","Layout","props","state","accountAddress","userConnected","blogPost","postCount","posts","loading","commentLoading","postLoading","createPost","bind","commentPost","setUserAddress","fetchData","window","ethereum","web3","eth","net","getId","networkId","networkData","networks","setState","Contract","abi","address","methods","call","i","post","sort","a","b","id","title","content","send","from","account","toString","once","receipt","console","log","input","container","setAccount","main","col4","col8"],"mappings":"6yCAAA,MAAOA,CAAAA,OAAP,KAAoB,qBAApB,CACA,MAAOC,CAAAA,KAAP,EAAeC,SAAf,KAA+B,OAA/B,CACA,OAAQC,SAAR,CAAmBC,GAAnB,CAAwBC,GAAxB,KAAkC,iBAAlC,CACA,MAAOC,CAAAA,aAAP,KAA0B,UAA1B,CACA,MAAOC,CAAAA,MAAP,KAAmB,UAAnB,CACA,MAAOC,CAAAA,WAAP,KAAwB,sBAAxB,CACA,MAAOC,CAAAA,IAAP,KAAiB,MAAjB,CACA,MAAOC,CAAAA,IAAP,KAAiB,sBAAjB,C,GAGMC,CAAAA,M,gGAwEF,gBAAYC,KAAZ,CAAmB,wCACf,uBAAMA,KAAN,EACA,MAAKC,KAAL,CAAa,CACTC,cAAc,CAAE,EADP,CAETC,aAAa,CAAE,KAFN,CAGTC,QAAQ,CAAE,IAHD,CAITC,SAAS,CAAE,CAJF,CAKTC,KAAK,CAAE,EALE,CAMTC,OAAO,CAAE,IANA,CAOTC,cAAc,CAAE,KAPP,CAQTC,WAAW,CAAE,IARJ,CAAb,CAWA,MAAKC,UAAL,CAAkB,MAAKA,UAAL,CAAgBC,IAAhB,+BAAlB,CACA,MAAKC,WAAL,CAAmB,MAAKA,WAAL,CAAiBD,IAAjB,+BAAnB,CACA,MAAKE,cAAL,CAAsB,MAAKA,cAAL,CAAoBF,IAApB,+BAAtB,CAfe,aAgBlB,C,gJArFD,yJAEU,MAAKG,SAAL,EAFV,4D,2NAMA,qMAEQC,MAAM,CAACC,QAFf,2BAIQD,MAAM,CAACE,IAAP,CAAc,GAAIpB,CAAAA,IAAJ,CAASkB,MAAM,CAACC,QAAhB,CAAd,CACA;AACA;AACA;AACA;AACMC,IATd,CASqBF,MAAM,CAACE,IAT5B,wBAUgCA,CAAAA,IAAI,CAACC,GAAL,CAASC,GAAT,CAAaC,KAAb,EAVhC,QAUcC,SAVd,gBAWcC,WAXd,CAW4BxB,IAAI,CAACyB,QAAL,CAAcF,SAAd,CAX5B,KAYYC,WAZZ,2BAaY,KAAKE,QAAL,CAAc,CAACjB,OAAO,CAAE,KAAV,CAAd,EACA,KAAKiB,QAAL,CAAc,CAACf,WAAW,CAAE,KAAd,CAAd,EACML,QAflB,CAe6B,GAAIa,CAAAA,IAAI,CAACC,GAAL,CAASO,QAAb,CAAsB3B,IAAI,CAAC4B,GAA3B,CAAgCJ,WAAW,CAACK,OAA5C,CAf7B,CAgBY,KAAKH,QAAL,CAAc,CAACpB,QAAQ,CAAEA,QAAX,CAAd,EAhBZ,wBAiBoCA,CAAAA,QAAQ,CAACwB,OAAT,CAAiBvB,SAAjB,GAA6BwB,IAA7B,EAjBpC,SAiBkBxB,SAjBlB,gBAkBY,KAAKmB,QAAL,CAAc,CAACnB,SAAS,CAAEA,SAAZ,CAAd,EACA;AACA,KAAKmB,QAAL,CAAc,CAAClB,KAAK,CAAE,EAAR,CAAd,EACSwB,CArBrB,CAqByB,CArBzB,cAqB4BA,CAAC,EAAIzB,SArBjC,oDAsBmCD,CAAAA,QAAQ,CAACwB,OAAT,CAAiBtB,KAAjB,CAAuBwB,CAAvB,EAA0BD,IAA1B,EAtBnC,SAsBsBE,IAtBtB,gBAuBgB,KAAKP,QAAL,CAAc,CACVlB,KAAK,8BAAM,KAAKL,KAAL,CAAWK,KAAjB,GAAwByB,IAAxB,EADK,CAAd,EAvBhB,QAqB4CD,CAAC,EArB7C,iCA2BY;AACA,KAAKN,QAAL,CAAc,CACVlB,KAAK,CAAE,KAAKL,KAAL,CAAWK,KAAX,CAAiB0B,IAAjB,CAAsB,SAACC,CAAD,CAAIC,CAAJ,QAAUA,CAAAA,CAAC,CAACC,EAAF,CAAOF,CAAC,CAACE,EAAnB,EAAtB,CADG,CAAd,EAGA,KAAKX,QAAL,CAAc,CAACjB,OAAO,CAAE,KAAV,CAAd,EA/BZ,8D,kMAsCA,kBAAiB6B,KAAjB,CAAwBC,OAAxB,sIACI,KAAKb,QAAL,CAAc,CAACf,WAAW,CAAE,IAAd,CAAd,EACA,KAAKR,KAAL,CAAWG,QAAX,CAAoBwB,OAApB,CAA4BlB,UAA5B,CAAuC0B,KAAvC,CAA8CC,OAA9C,EAAuDC,IAAvD,CAA4D,CAACC,IAAI,CAAE,KAAKvC,KAAL,CAAWwC,OAAX,CAAmBC,QAAnB,EAAP,CAA5D,EACKC,IADL,CACU,SADV,CACqB,SAACC,OAAD,CAAa,CAC1B,MAAI,CAAC7B,SAAL,GACA,MAAI,CAACU,QAAL,CAAc,CAACf,WAAW,CAAE,KAAd,CAAd,EACAmC,OAAO,CAACC,GAAR,CAAY,MAAI,CAAC5C,KAAL,CAAWC,cAAvB,EACH,CALL,EAFJ,6D,6MAUA,kBAAkBiC,EAAlB,CAAsBE,OAAtB,sIACI,KAAKb,QAAL,CAAc,CAACf,WAAW,CAAE,IAAd,CAAd,EACA,KAAKe,QAAL,CAAc,CAAChB,cAAc,CAAE,IAAjB,CAAd,EACA,KAAKP,KAAL,CAAWG,QAAX,CAAoBwB,OAApB,CAA4BhB,WAA5B,CAAwCuB,EAAxC,CAA4CE,OAA5C,EAAqDC,IAArD,CAA0D,CAACC,IAAI,CAAE,KAAKtC,KAAL,CAAWC,cAAlB,CAA1D,EACKwC,IADL,CACU,SADV,CACqB,SAACC,OAAD,CAAa,CAC1B,MAAI,CAAC7B,SAAL,GACA,MAAI,CAACU,QAAL,CAAc,CAAChB,cAAc,CAAE,KAAjB,CAAd,EACA,MAAI,CAACgB,QAAL,CAAc,CAACf,WAAW,CAAE,KAAd,CAAd,EACH,CALL,EAHJ,6D,uNAWA,kBAAqBqC,KAArB,sHACI,KAAKtB,QAAL,CAAc,CAACtB,cAAc,CAAE4C,KAAjB,CAAd,EADJ,6D,6HAsBA,iBAAS,CACL,mBAEI,oBAAC,SAAD,EAAW,KAAK,KAAhB,CAAiB,SAAS,CAAE1D,OAAO,CAAC2D,SAApC,eACI,oBAAC,aAAD,EAAe,WAAW,CAAE,KAAKlC,cAAjC,CAAiD,OAAO,CAAE,KAAKb,KAAL,CAAWwC,OAArE,CACe,UAAU,CAAE,KAAKxC,KAAL,CAAWgD,UADtC,EADJ,cAGI,oBAAC,GAAD,EAAK,SAAS,CAAE5D,OAAO,CAAC6D,IAAxB,eACI,oBAAC,GAAD,EAAK,EAAE,CAAE,CAAT,CAAY,SAAS,CAAE7D,OAAO,CAAC8D,IAA/B,mBAAsC,oBAAC,MAAD,EAClC,UAAU,CAAE,KAAKxC,UADiB,CAElC,KAAK,CAAE,KAAKV,KAAL,CAAWwC,OAFgB,EAAtC,KADJ,cAMI,oBAAC,GAAD,EAAK,EAAE,CAAE,CAAT,CAAY,SAAS,CAAEpD,OAAO,CAAC+D,IAA/B,mBAAsC,oBAAC,WAAD,EAClC,cAAc,CAAE,KAAKlD,KAAL,CAAWO,cADO,CAElC,QAAQ,CAAE,KAAKP,KAAL,CAAWG,QAFa,CAGlC,OAAO,CAAE,KAAKJ,KAAL,CAAWwC,OAHc,CAIlC,OAAO,CAAE,KAAKvC,KAAL,CAAWM,OAJc,CAKlC,WAAW,CAAE,KAAKN,KAAL,CAAWQ,WALU,CAMlC,gBAAgB,CAAE,KAAKR,KAAL,CAAWK,KANK,CAOlC,WAAW,CAAE,KAAKM,WAPgB,CAQlC,KAAK,CAAE,KAAKZ,KAAL,CAAWwC,OARgB,EAAtC,KANJ,CAHJ,cAoBI,8BAAQ,EAAE,CAAC,eAAX,CAA2B,SAAS,CAAC,0CAArC,eACI,2BAAK,SAAS,CAAC,uBAAf,eACI,iEADJ,CADJ,CApBJ,CAFJ,CA+BH,C,oBA1HgBlD,S,EA6HrB,cAAeS,CAAAA,MAAf","sourcesContent":["import classes from './Layout.module.css'\r\nimport React, {Component} from 'react'\r\nimport {Container, Row, Col} from 'react-bootstrap'\r\nimport NavigationBar from \"./Navbar\";\r\nimport Banner from \"./Banner\";\r\nimport PostSection from \"../posts/PostSection\";\r\nimport Web3 from \"web3\";\r\nimport Blog from \"../../abis/Blog.json\";\r\n\r\n\r\nclass Layout extends Component {\r\n\r\n\r\n    async componentWillMount() {\r\n\r\n        await this.fetchData()\r\n    }\r\n\r\n\r\n    async fetchData() {\r\n\r\n        if (window.ethereum) {\r\n\r\n            window.web3 = new Web3(window.ethereum)\r\n            // } else\r\n            // if (window.web3) {\r\n            // window.web3 = new Web3(window.web3.currentProvider)\r\n            // window.web3 = new Web3(window.ethereum)\r\n            const web3 = window.web3\r\n            const networkId = await web3.eth.net.getId()\r\n            const networkData = Blog.networks[networkId]\r\n            if (networkData) {\r\n                this.setState({loading: false})\r\n                this.setState({postLoading: false})\r\n                const blogPost = new web3.eth.Contract(Blog.abi, networkData.address)\r\n                this.setState({blogPost: blogPost})\r\n                const postCount = await blogPost.methods.postCount().call()\r\n                this.setState({postCount: postCount})\r\n                // Load Posts\r\n                this.setState({posts: []})\r\n                for (var i = 1; i <= postCount; i++) {\r\n                    const post = await blogPost.methods.posts(i).call()\r\n                    this.setState({\r\n                        posts: [...this.state.posts, post]\r\n                    })\r\n                }\r\n                // Sort posts. Show highest tipped posts first\r\n                this.setState({\r\n                    posts: this.state.posts.sort((a, b) => b.id - a.id)\r\n                })\r\n                this.setState({loading: false})\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n    async createPost(title, content) {\r\n        this.setState({postLoading: true})\r\n        this.state.blogPost.methods.createPost(title, content).send({from: this.props.account.toString()})\r\n            .once('receipt', (receipt) => {\r\n                this.fetchData()\r\n                this.setState({postLoading: false})\r\n                console.log(this.state.accountAddress)\r\n            })\r\n    }\r\n\r\n    async commentPost(id, content) {\r\n        this.setState({postLoading: true})\r\n        this.setState({commentLoading: true})\r\n        this.state.blogPost.methods.commentPost(id, content).send({from: this.state.accountAddress})\r\n            .once('receipt', (receipt) => {\r\n                this.fetchData()\r\n                this.setState({commentLoading: false})\r\n                this.setState({postLoading: false})\r\n            })\r\n    }\r\n\r\n    async setUserAddress(input) {\r\n        this.setState({accountAddress: input})\r\n    }\r\n\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            accountAddress: '',\r\n            userConnected: false,\r\n            blogPost: null,\r\n            postCount: 0,\r\n            posts: [],\r\n            loading: true,\r\n            commentLoading: false,\r\n            postLoading: true\r\n        }\r\n\r\n        this.createPost = this.createPost.bind(this)\r\n        this.commentPost = this.commentPost.bind(this)\r\n        this.setUserAddress = this.setUserAddress.bind(this)\r\n    }\r\n\r\n    render() {\r\n        return (\r\n\r\n            <Container fluid className={classes.container}>\r\n                <NavigationBar userAccount={this.setUserAddress} account={this.props.account}\r\n                               setAccount={this.props.setAccount}/>\r\n                <Row className={classes.main}>\r\n                    <Col lg={4} className={classes.col4}> <Banner\r\n                        createpost={this.createPost}\r\n                        input={this.props.account}\r\n\r\n                    /> </Col>\r\n                    <Col lg={8} className={classes.col8}> <PostSection\r\n                        commentLoading={this.state.commentLoading}\r\n                        blogPost={this.state.blogPost}\r\n                        account={this.props.account}\r\n                        loading={this.state.loading}\r\n                        postLoading={this.state.postLoading}\r\n                        postSectionPosts={this.state.posts}\r\n                        commentPost={this.commentPost}\r\n                        input={this.props.account}/> </Col>\r\n                </Row>\r\n\r\n                <footer id=\"sticky-footer\" className=\"flex-shrink-0 py-4 bg-dark text-white-50\">\r\n                    <div className=\"container text-center\">\r\n                        <small>Copyright &copy; billvittis.eth</small>\r\n                    </div>\r\n                </footer>\r\n\r\n            </Container>\r\n\r\n        )\r\n    }\r\n}\r\n\r\nexport default Layout"]},"metadata":{},"sourceType":"module"}